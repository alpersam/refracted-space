---
import Base from "../../layouts/Base.astro";
import { getCollection } from "astro:content";

const posts = (await getCollection("blog"))
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

// Group by year
const byYear = posts.reduce(
  (acc, post) => {
    const year = post.data.date.getFullYear().toString();
    if (!acc[year]) acc[year] = [];
    acc[year].push(post);
    return acc;
  },
  {} as Record<string, typeof posts>,
);

const years = Object.keys(byYear).sort((a, b) => Number(b) - Number(a));
---

<Base title="Writing" description="All posts on space engineering, Zurich, and identity.">
  <section class="container page-header fade-up">
    <h1>Writing</h1>
    <p class="page-desc">Thoughts on space engineering, life in ZÃ¼rich, and the things between.</p>
  </section>

  <section class="container posts fade-up stagger-2">
    {years.map((year) => (
      <div class="year-group">
        <div class="year-label mono">{year}</div>
        <ul class="post-list">
          {byYear[year].map((post) => (
            <li>
              <a href={`/blog/${post.id}`} class="post-row">
                <time class="mono" datetime={post.data.date.toISOString()}>
                  {post.data.date.toLocaleDateString("en-US", {
                    month: "short",
                    day: "numeric",
                  })}
                </time>
                <span class="post-title">{post.data.title}</span>

              </a>
            </li>
          ))}
        </ul>
      </div>
    ))}
  </section>
</Base>

<style>
  .page-header {
    padding: var(--space-24) 0 var(--space-16);
  }

  .page-header h1 {
    font-size: var(--text-4xl);
    font-weight: 700;
    letter-spacing: -0.03em;
    margin-bottom: var(--space-4);
  }

  .page-desc {
    color: var(--color-text-secondary);
    max-width: 28rem;
    margin-bottom: 0;
  }

  .posts {
    padding-bottom: var(--space-24);
  }

  .year-group {
    margin-bottom: var(--space-12);
  }

  .year-label {
    font-size: var(--text-xs);
    color: var(--color-text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    padding-bottom: var(--space-3);
    border-bottom: 1px solid var(--color-border);
    margin-bottom: var(--space-2);
  }

  .post-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .post-row {
    display: flex;
    align-items: center;
    gap: var(--space-6);
    padding: var(--space-4) 0;
    border-bottom: 1px solid var(--color-border);
    transition: background var(--duration) var(--ease-out);
  }

  .post-row:hover {
    color: var(--color-text);
  }

  .post-row time {
    flex-shrink: 0;
    width: 4.5rem;
    font-size: var(--text-xs);
    color: var(--color-text-secondary);
  }

  .post-title {
    flex: 1;
    font-weight: 500;
  }

  @media (max-width: 768px) {
    .post-row {
      flex-wrap: wrap;
      gap: var(--space-2);
    }

    .post-row time {
      width: auto;
    }
  }
</style>
